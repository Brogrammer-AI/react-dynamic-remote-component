{"version":3,"file":"index.js","sources":["../../src/utils.ts","../../src/attach-script.ts","../../src/load-module.ts","../../src/suspend.ts","../../src/RemoteComponent.tsx"],"sourcesContent":["import { RemoteModule } from \"./types\";\n\nexport const getRemoteModuleId = ({ url, module, scope }: RemoteModule) =>\n  [url, scope, module].join();\n","import { RemoteModule } from \"./types\";\nimport { getRemoteModuleId } from \"./utils\";\n\nexport const attachScript = (remoteModule: RemoteModule) => {\n  const id = getRemoteModuleId(remoteModule);\n\n  const existingElement = document.getElementById(id);\n\n  if (existingElement) {\n    //@ts-expect-error\n    if (window[remoteModule.scope]) return Promise.resolve(true);\n    else\n      return new Promise((resolve) => {\n        existingElement.onload = (e) => {\n          resolve(true);\n        };\n      });\n  }\n  const element = document.createElement(\"script\");\n  element.src = remoteModule.url;\n  element.type = \"text/javascript\";\n  element.async = true;\n  element.id = id;\n\n  const scriptLoadPromise = new Promise<HTMLScriptElement>(\n    (resolve, reject) => {\n      element.onload = () => resolve(element);\n      element.onerror = (e) => {\n        reject(e);\n      };\n    }\n  );\n\n  document.head.appendChild(element);\n\n  return scriptLoadPromise;\n};\n\nexport const detachScript = (id: string) => {\n  const element = document.getElementById(id);\n  if (element) document.head.removeChild(element);\n};\n","/* eslint-disable no-unreachable */\nexport const loadModule = (url: string, scope: string, module: string) => {\n  return async () => {\n    try {\n      //@ts-expect-error\n      await __webpack_init_sharing__(\"default\");\n      const container = window[scope];\n\n      if (!container.isInitialized) {\n        container.isInitialized = true;\n        //@ts-expect-error\n        await container.init(__webpack_share_scopes__.default);\n      }\n\n      const factory = await window[scope].get(module);\n\n      const Module = factory();\n\n      return Module;\n    } catch (e) {\n      const error = new Error(\n        `There was a problem loading the remote module. Please check the parameters (url: ${url} scope: ${scope} module: ${module})`\n      );\n      error.name = \"RemoteModuleLoadingError\";\n      throw error;\n    }\n  };\n};\n","export const suspend = (promise: Promise<any>) => {\n  let result: any;\n  let status = \"pending\";\n\n  const suspender = promise.then(\n    (response) => {\n      status = \"success\";\n      result = response;\n    },\n    (error) => {\n      status = \"error\";\n      result = error;\n    }\n  );\n\n  return () => {\n    switch (status) {\n      case \"pending\": {\n        throw suspender;\n      }\n      case \"error\": {\n        throw result;\n      }\n      default: {\n        return result;\n      }\n    }\n  };\n};\n","import { FC } from \"react\";\nimport { attachScript } from \"./attach-script\";\nimport { loadModule } from \"./load-module\";\nimport { RemoteModule } from \"./types\";\nimport { suspend } from \"./suspend\";\nimport { getRemoteModuleId } from \"./utils\";\n\nexport type RemoteComponentProps = RemoteModule & {\n  unLoadScriptOnUnmount?: boolean;\n  exportName?: \"string\";\n};\n\nexport const getModule = (remoteModule: RemoteModule) => {\n  window.remoteModuleDictionary = window.remoteModuleDictionary || {};\n  const id = getRemoteModuleId(remoteModule);\n  const existingModule = window.remoteModuleDictionary[id];\n\n  if (existingModule) return existingModule;\n  else {\n    window.remoteModuleDictionary[id] = new Promise((resolve) => {\n      attachScript(remoteModule).then(() => {\n        resolve(\n          loadModule(\n            remoteModule.url,\n            remoteModule.scope,\n            remoteModule.module\n          )()\n        );\n      });\n    });\n    return window.remoteModuleDictionary[id];\n  }\n};\n\nconst getModuleSuspended = (remoteModule: RemoteModule) => {\n  window.remoteObjectDictionary = window.remoteObjectDictionary || {};\n  const id = getRemoteModuleId(remoteModule);\n  const existingCaller = window.remoteObjectDictionary[id];\n  if (existingCaller) return existingCaller();\n  else {\n    const caller = suspend(getModule(remoteModule));\n    window.remoteObjectDictionary[id] = caller;\n    return caller();\n  }\n};\n\nexport const useRemoteModule = (remoteModule: RemoteModule) => {\n  return getModuleSuspended(remoteModule);\n};\n\nexport const RemoteComponent: FC<RemoteComponentProps> = ({\n  unLoadScriptOnUnmount = true,\n  exportName = \"default\",\n  ...remoteModule\n}) => {\n  const { [exportName]: Component } = getModuleSuspended(remoteModule);\n\n  return <Component />;\n};\n"],"names":["getRemoteModuleId","url","module","scope","join","attachScript","remoteModule","id","existingElement","document","getElementById","window","Promise","resolve","onload","e","element","createElement","src","type","async","scriptLoadPromise","reject","onerror","head","appendChild","loadModule","__webpack_init_sharing__","container","isInitialized","init","__webpack_share_scopes__","default","get","factory","Module","error","Error","name","suspend","promise","result","status","suspender","then","response","getModule","remoteModuleDictionary","existingModule","getModuleSuspended","remoteObjectDictionary","existingCaller","caller","useRemoteModule","RemoteComponent","unLoadScriptOnUnmount","exportName","Component","_jsx"],"mappings":";;;;;AAEO,IAAMA,iBAAiB,GAAG,SAApBA,iBAAoB;AAAA,MAAGC,GAAH,QAAGA,GAAH;AAAA,MAAQC,MAAR,QAAQA,MAAR;AAAA,MAAgBC,KAAhB,QAAgBA,KAAhB;AAAA,SAC/B,CAACF,GAAD,EAAME,KAAN,EAAaD,MAAb,EAAqBE,IAArB,EAD+B;AAAA,CAA1B;;ACCA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,YAAD,EAAgC;AAC1D,MAAMC,EAAE,GAAGP,iBAAiB,CAACM,YAAD,CAA5B;AAEA,MAAME,eAAe,GAAGC,QAAQ,CAACC,cAAT,CAAwBH,EAAxB,CAAxB;;AAEA,MAAIC,eAAJ,EAAqB;AACnB;AACA,QAAIG,MAAM,CAACL,YAAY,CAACH,KAAd,CAAV,EAAgC,OAAOS,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP,CAAhC,KAEE,OAAO,IAAID,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9BL,MAAAA,eAAe,CAACM,MAAhB,GAAyB,UAACC,CAAD,EAAO;AAC9BF,QAAAA,OAAO,CAAC,IAAD,CAAP;AACD,OAFD;AAGD,KAJM,CAAP;AAKH;;AACD,MAAMG,OAAO,GAAGP,QAAQ,CAACQ,aAAT,CAAuB,QAAvB,CAAhB;AACAD,EAAAA,OAAO,CAACE,GAAR,GAAcZ,YAAY,CAACL,GAA3B;AACAe,EAAAA,OAAO,CAACG,IAAR,GAAe,iBAAf;AACAH,EAAAA,OAAO,CAACI,KAAR,GAAgB,IAAhB;AACAJ,EAAAA,OAAO,CAACT,EAAR,GAAaA,EAAb;AAEA,MAAMc,iBAAiB,GAAG,IAAIT,OAAJ,CACxB,UAACC,OAAD,EAAUS,MAAV,EAAqB;AACnBN,IAAAA,OAAO,CAACF,MAAR,GAAiB;AAAA,aAAMD,OAAO,CAACG,OAAD,CAAb;AAAA,KAAjB;;AACAA,IAAAA,OAAO,CAACO,OAAR,GAAkB,UAACR,CAAD,EAAO;AACvBO,MAAAA,MAAM,CAACP,CAAD,CAAN;AACD,KAFD;AAGD,GANuB,CAA1B;AASAN,EAAAA,QAAQ,CAACe,IAAT,CAAcC,WAAd,CAA0BT,OAA1B;AAEA,SAAOK,iBAAP;AACD,CAjCM;;ACHP;AACO,IAAMK,UAAU,GAAG,SAAbA,UAAa,CAACzB,GAAD,EAAcE,KAAd,EAA6BD,MAA7B,EAAgD;AACxE,+EAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAGGyB,wBAAwB,CAAC,SAAD,CAH3B;;AAAA;AAIGC,YAAAA,SAJH,GAIejB,MAAM,CAACR,KAAD,CAJrB;;AAAA,gBAMEyB,SAAS,CAACC,aANZ;AAAA;AAAA;AAAA;;AAODD,YAAAA,SAAS,CAACC,aAAV,GAA0B,IAA1B,CAPC;;AAAA;AAAA,mBASKD,SAAS,CAACE,IAAV,CAAeC,wBAAwB,CAACC,OAAxC,CATL;;AAAA;AAAA;AAAA,mBAYmBrB,MAAM,CAACR,KAAD,CAAN,CAAc8B,GAAd,CAAkB/B,MAAlB,CAZnB;;AAAA;AAYGgC,YAAAA,OAZH;AAcGC,YAAAA,MAdH,GAcYD,OAAO,EAdnB;AAAA,6CAgBIC,MAhBJ;;AAAA;AAAA;AAAA;AAkBGC,YAAAA,KAlBH,GAkBW,IAAIC,KAAJ,4FACwEpC,GADxE,qBACsFE,KADtF,sBACuGD,MADvG,OAlBX;AAqBHkC,YAAAA,KAAK,CAACE,IAAN,GAAa,0BAAb;AArBG,kBAsBGF,KAtBH;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAP;AAyBD,CA1BM;;ACDA,IAAMG,OAAO,GAAG,SAAVA,OAAU,CAACC,OAAD,EAA2B;AAChD,MAAIC,MAAJ;AACA,MAAIC,MAAM,GAAG,SAAb;AAEA,MAAMC,SAAS,GAAGH,OAAO,CAACI,IAAR,CAChB,UAACC,QAAD,EAAc;AACZH,IAAAA,MAAM,GAAG,SAAT;AACAD,IAAAA,MAAM,GAAGI,QAAT;AACD,GAJe,EAKhB,UAACT,KAAD,EAAW;AACTM,IAAAA,MAAM,GAAG,OAAT;AACAD,IAAAA,MAAM,GAAGL,KAAT;AACD,GARe,CAAlB;AAWA,SAAO,YAAM;AACX,YAAQM,MAAR;AACE,WAAK,SAAL;AAAgB;AACd,gBAAMC,SAAN;AACD;;AACD,WAAK,OAAL;AAAc;AACZ,gBAAMF,MAAN;AACD;;AACD;AAAS;AACP,iBAAOA,MAAP;AACD;AATH;AAWD,GAZD;AAaD,CA5BM;;;ICYMK,SAAS,GAAG,SAAZA,SAAY,CAACxC,YAAD,EAAgC;AACvDK,EAAAA,MAAM,CAACoC,sBAAP,GAAgCpC,MAAM,CAACoC,sBAAP,IAAiC,EAAjE;AACA,MAAMxC,EAAE,GAAGP,iBAAiB,CAACM,YAAD,CAA5B;AACA,MAAM0C,cAAc,GAAGrC,MAAM,CAACoC,sBAAP,CAA8BxC,EAA9B,CAAvB;AAEA,MAAIyC,cAAJ,EAAoB,OAAOA,cAAP,CAApB,KACK;AACHrC,IAAAA,MAAM,CAACoC,sBAAP,CAA8BxC,EAA9B,IAAoC,IAAIK,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC3DR,MAAAA,YAAY,CAACC,YAAD,CAAZ,CAA2BsC,IAA3B,CAAgC,YAAM;AACpC/B,QAAAA,OAAO,CACLa,UAAU,CACRpB,YAAY,CAACL,GADL,EAERK,YAAY,CAACH,KAFL,EAGRG,YAAY,CAACJ,MAHL,CAAV,EADK,CAAP;AAOD,OARD;AASD,KAVmC,CAApC;AAWA,WAAOS,MAAM,CAACoC,sBAAP,CAA8BxC,EAA9B,CAAP;AACD;AACF;;AAED,IAAM0C,kBAAkB,GAAG,SAArBA,kBAAqB,CAAC3C,YAAD,EAAgC;AACzDK,EAAAA,MAAM,CAACuC,sBAAP,GAAgCvC,MAAM,CAACuC,sBAAP,IAAiC,EAAjE;AACA,MAAM3C,EAAE,GAAGP,iBAAiB,CAACM,YAAD,CAA5B;AACA,MAAM6C,cAAc,GAAGxC,MAAM,CAACuC,sBAAP,CAA8B3C,EAA9B,CAAvB;AACA,MAAI4C,cAAJ,EAAoB,OAAOA,cAAc,EAArB,CAApB,KACK;AACH,QAAMC,MAAM,GAAGb,OAAO,CAACO,SAAS,CAACxC,YAAD,CAAV,CAAtB;AACAK,IAAAA,MAAM,CAACuC,sBAAP,CAA8B3C,EAA9B,IAAoC6C,MAApC;AACA,WAAOA,MAAM,EAAb;AACD;AACF,CAVD;;IAYaC,eAAe,GAAG,SAAlBA,eAAkB,CAAC/C,YAAD,EAAgC;AAC7D,SAAO2C,kBAAkB,CAAC3C,YAAD,CAAzB;AACD;IAEYgD,eAAyC,GAAG,SAA5CA,eAA4C,OAInD;AAAA,OAHJC,qBAGI;AAAA,iCAFJC,UAEI;AAAA,MAFJA,UAEI,gCAFS,SAET;AAAA,MADDlD,YACC;;AACJ,4BAAoC2C,kBAAkB,CAAC3C,YAAD,CAAtD;AAAA,MAAsBmD,SAAtB,uBAASD,UAAT;;AAEA,sBAAOE,IAAC,SAAD,KAAP;AACD;;;;"}