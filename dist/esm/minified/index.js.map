{"version":3,"file":"index.js","sources":["../../../src/utils.ts","../../../src/RemoteComponent.tsx","../../../src/attach-script.ts","../../../src/load-module.ts","../../../src/suspend.ts"],"sourcesContent":["import { RemoteModule } from \"./types\";\n\nexport const getRemoteModuleId = ({ url, module, scope }: RemoteModule) =>\n  [url, scope, module].join();\n","import { FC } from \"react\";\nimport { attachScript } from \"./attach-script\";\nimport { loadModule } from \"./load-module\";\nimport { RemoteModule } from \"./types\";\nimport { suspend } from \"./suspend\";\nimport { getRemoteModuleId } from \"./utils\";\n\nexport type RemoteComponentProps = RemoteModule & {\n  unLoadScriptOnUnmount?: boolean;\n  exportName?: \"string\";\n};\n\nexport const getModule = (remoteModule: RemoteModule) => {\n  window.remoteModuleDictionary = window.remoteModuleDictionary || {};\n  const id = getRemoteModuleId(remoteModule);\n  const existingModule = window.remoteModuleDictionary[id];\n\n  if (existingModule) return existingModule;\n  else {\n    window.remoteModuleDictionary[id] = new Promise((resolve) => {\n      attachScript(remoteModule).then(() => {\n        resolve(\n          loadModule(\n            remoteModule.url,\n            remoteModule.scope,\n            remoteModule.module\n          )()\n        );\n      });\n    });\n    return window.remoteModuleDictionary[id];\n  }\n};\n\nconst getModuleSuspended = (remoteModule: RemoteModule) => {\n  window.remoteObjectDictionary = window.remoteObjectDictionary || {};\n  const id = getRemoteModuleId(remoteModule);\n  const existingCaller = window.remoteObjectDictionary[id];\n  if (existingCaller) return existingCaller();\n  else {\n    const caller = suspend(getModule(remoteModule));\n    window.remoteObjectDictionary[id] = caller;\n    return caller();\n  }\n};\n\nexport const useRemoteModule = (remoteModule: RemoteModule) => {\n  return getModuleSuspended(remoteModule);\n};\n\nexport const RemoteComponent: FC<RemoteComponentProps> = ({\n  unLoadScriptOnUnmount = true,\n  exportName = \"default\",\n  ...remoteModule\n}) => {\n  const { [exportName]: Component } = getModuleSuspended(remoteModule);\n\n  return <Component />;\n};\n","import { RemoteModule } from \"./types\";\nimport { getRemoteModuleId } from \"./utils\";\n\nexport const attachScript = (remoteModule: RemoteModule) => {\n  const id = getRemoteModuleId(remoteModule);\n\n  const existingElement = document.getElementById(id);\n\n  if (existingElement) {\n    //@ts-expect-error\n    if (window[remoteModule.scope]) return Promise.resolve(true);\n    else\n      return new Promise((resolve) => {\n        existingElement.onload = (e) => {\n          resolve(true);\n        };\n      });\n  }\n  const element = document.createElement(\"script\");\n  element.src = remoteModule.url;\n  element.type = \"text/javascript\";\n  element.async = true;\n  element.id = id;\n\n  const scriptLoadPromise = new Promise<HTMLScriptElement>(\n    (resolve, reject) => {\n      element.onload = () => resolve(element);\n      element.onerror = (e) => {\n        reject(e);\n      };\n    }\n  );\n\n  document.head.appendChild(element);\n\n  return scriptLoadPromise;\n};\n\nexport const detachScript = (id: string) => {\n  const element = document.getElementById(id);\n  if (element) document.head.removeChild(element);\n};\n","/* eslint-disable no-unreachable */\nexport const loadModule = (url: string, scope: string, module: string) => {\n  return async () => {\n    try {\n      //@ts-expect-error\n      await __webpack_init_sharing__(\"default\");\n      const container = window[scope];\n\n      if (!container.isInitialized) {\n        container.isInitialized = true;\n        //@ts-expect-error\n        await container.init(__webpack_share_scopes__.default);\n      }\n\n      const factory = await window[scope].get(module);\n\n      const Module = factory();\n\n      return Module;\n    } catch (e) {\n      const error = new Error(\n        `There was a problem loading the remote module. Please check the parameters (url: ${url} scope: ${scope} module: ${module})`\n      );\n      error.name = \"RemoteModuleLoadingError\";\n      throw error;\n    }\n  };\n};\n","export const suspend = (promise: Promise<any>) => {\n  let result: any;\n  let status = \"pending\";\n\n  const suspender = promise.then(\n    (response) => {\n      status = \"success\";\n      result = response;\n    },\n    (error) => {\n      status = \"error\";\n      result = error;\n    }\n  );\n\n  return () => {\n    switch (status) {\n      case \"pending\": {\n        throw suspender;\n      }\n      case \"error\": {\n        throw result;\n      }\n      default: {\n        return result;\n      }\n    }\n  };\n};\n"],"names":["getRemoteModuleId","url","module","scope","join","getModule","remoteModule","window","remoteModuleDictionary","id","existingModule","Promise","resolve","existingElement","document","getElementById","onload","e","element","createElement","src","type","async","scriptLoadPromise","reject","onerror","head","appendChild","attachScript","then","__webpack_init_sharing__","container","isInitialized","init","__webpack_share_scopes__","default","get","factory","Module","error","Error","name","getModuleSuspended","remoteObjectDictionary","existingCaller","promise","result","status","suspender","caller","response","useRemoteModule","RemoteComponent","unLoadScriptOnUnmount","exportName","Component","_jsx"],"mappings":"uMAEO,IAAMA,EAAoB,gBAAGC,IAAAA,IAAKC,IAAAA,aACvC,CAACD,IAD8CE,MAClCD,GAAQE,iDCSVC,EAAY,SAACC,GACxBC,OAAOC,uBAAyBD,OAAOC,wBAA0B,OAC3DC,EAAKT,EAAkBM,GACvBI,EAAiBH,OAAOC,uBAAuBC,UAEjDC,IAEFH,OAAOC,uBAAuBC,GAAM,IAAIE,SAAQ,SAACC,IChBzB,SAACN,OACrBG,EAAKT,EAAkBM,GAEvBO,EAAkBC,SAASC,eAAeN,MAE5CI,SAEEN,OAAOD,EAAaH,OAAeQ,QAAQC,SAAQ,GAE9C,IAAID,SAAQ,SAACC,GAClBC,EAAgBG,OAAS,SAACC,GACxBL,GAAQ,WAIVM,EAAUJ,SAASK,cAAc,UACvCD,EAAQE,IAAMd,EAAaL,IAC3BiB,EAAQG,KAAO,kBACfH,EAAQI,OAAQ,EAChBJ,EAAQT,GAAKA,MAEPc,EAAoB,IAAIZ,SAC5B,SAACC,EAASY,GACRN,EAAQF,OAAS,kBAAMJ,EAAQM,IAC/BA,EAAQO,QAAU,SAACR,GACjBO,EAAOP,cAKbH,SAASY,KAAKC,YAAYT,GAEnBK,GDfHK,CAAatB,GAAcuB,MAAK,WEnBZ,IAAC5B,EAAaE,EAAeD,EFoB/CU,GEpBmBX,EFsBfK,EAAaL,IEtBeE,EFuB5BG,EAAaH,MEvB8BD,EFwB3CI,EAAaJ,iBEvBhB,iHAGG4B,yBAAyB,sBACzBC,EAAYxB,OAAOJ,IAEV6B,qCACbD,EAAUC,eAAgB,WAEpBD,EAAUE,KAAKC,yBAAyBC,iCAG1B5B,OAAOJ,GAAOiC,IAAIlC,kBAAlCmC,SAEAC,EAASD,sBAERC,4CAEDC,EAAQ,IAAIC,iGACoEvC,qBAAcE,sBAAiBD,SAE/GuC,KAAO,2BACPF,sEFMDhC,OAAOC,uBAAuBC,KAInCiC,EAAqB,SAACpC,GAC1BC,OAAOoC,uBAAyBpC,OAAOoC,wBAA0B,OAC3DlC,EAAKT,EAAkBM,GACvBsC,EAAiBrC,OAAOoC,uBAAuBlC,MACjDmC,EAAgB,OAAOA,QGtCLC,EAClBC,EACAC,EAEEC,EHoCEC,GGxCcJ,EHwCGxC,EAAUC,GGtC/ByC,EAAS,UAEPC,EAAYH,EAAQhB,MACxB,SAACqB,GACCH,EAAS,UACTD,EAASI,KAEX,SAACX,GACCQ,EAAS,QACTD,EAASP,KAIN,kBACGQ,OACD,gBACGC,MAEH,cACGF,iBAGCA,YHiBXvC,OAAOoC,uBAAuBlC,GAAMwC,EAC7BA,KAIEE,EAAkB,SAAC7C,UACvBoC,EAAmBpC,IAGf8C,EAA4C,cACvDC,8BACAC,WAAAA,aAAa,YACVhD,SAEmBiD,EAAcb,EAAmBpC,GAA9CgD,UAEFE,EAACD"}